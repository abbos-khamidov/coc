<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#0d0d0f">
    <title>CocBase ‚Äî –ø–æ–¥–±–æ—Ä –±–∞–∑ Clash of Clans</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://telegram.org/js/telegram-web-app.js" defer></script>
    <script>
        (function() {
            var WIKI_BASE = 'https://clash-of-clans-wiki.com';
            var CC_BASE = 'https://clashcodes.com';

            function getThImageUrl(th) {
                return WIKI_BASE + '/pics/town_hall/th' + th + '_min.jpg';
            }

            function makeBases(th, purpose) {
                var thStr = String(th);
                var ccFarm = CC_BASE + '/bases/th' + thStr + '-farming';
                var ccWar = CC_BASE + '/bases/th' + thStr + '-war';
                var ccLegend = CC_BASE + '/bases/legend';
                if (purpose === 'farming') {
                    return [
                        { type: 'TH' + th + ' –§–∞—Ä–º', description: '–§–∞—Ä–º-–±–∞–∑—ã –Ω–∞ ClashCodes. –ó–∞—â–∏—Ç–∞ —Ä–µ—Å—É—Ä—Å–æ–≤, –∫–æ–º–ø–∞–∫—Ç–Ω—ã–π —Ü–µ–Ω—Ç—Ä.', link: ccFarm, rating: 9 },
                        { type: 'TH' + th + ' –§–∞—Ä–º', description: '–†–∞–∑–Ω–µ—Å—ë–Ω–Ω—ã–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞, –ª–æ–≤—É—à–∫–∏ —É —Å–∫–ª–∞–¥–æ–≤. –ú–µ–Ω—å—à–µ –ø–æ—Ç–µ—Ä—å –ø—Ä–∏ —Ñ–∞—Ä–º–µ.', link: ccFarm, rating: 8 },
                        { type: 'TH' + th + ' –§–∞—Ä–º', description: '–ê–Ω—Ç–∏-2 –∑–≤–µ–∑–¥—ã, –∑–∞—â–∏—Ç–∞ —Ç—ë–º–Ω–æ–≥–æ —ç–ª–∏–∫—Å–∏—Ä–∞ –≤ —è–¥—Ä–µ.', link: ccFarm, rating: 9 },
                        { type: 'TH' + th + ' –§–∞—Ä–º', description: '–ö–æ–º–ø–∞–∫—Ç–Ω—ã–π —Ü–µ–Ω—Ç—Ä, —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –ø–æ –∫–æ–ª—å—Ü—É. –£–¥–æ–±–Ω–æ –¥–ª—è —Ñ–∞—Ä–º–∞ –ª–∏–≥.', link: ccFarm, rating: 7 },
                        { type: 'TH' + th + ' –§–∞—Ä–º', description: '–ó–∞—â–∏—Ç–∞ DE –≤ —è–¥—Ä–µ, –ª–æ–≤—É—à–∫–∏ –Ω–∞ –ø–æ–¥—Ö–æ–¥–∞—Ö.', link: ccFarm, rating: 8 },
                        { type: 'TH' + th + ' –§–∞—Ä–º', description: '–°–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ–∞—Ä–º. –í—Å–µ –±–∞–∑—ã ‚Äî —Å ClashCodes.', link: ccFarm, rating: 8 }
                    ];
                }
                if (purpose === 'push') {
                    return [
                        { type: 'TH' + th + ' –ü—É—à', description: 'Legend-–±–∞–∑—ã –Ω–∞ ClashCodes. –ó–∞—â–∏—Ç–∞ —Ä–∞—Ç—É—à–∏, –ø—É—à –∫—É–±–∫–æ–≤.', link: ccLegend, rating: 9 },
                        { type: 'TH' + th + ' –ü—É—à', description: '–ê–Ω—Ç–∏-–≤–æ–∑–¥—É—Ö –∏ –∞–Ω—Ç–∏-–∑–µ–º–ª—è. –°–ª–æ–∂–Ω–æ –≤–∑—è—Ç—å 3 –∑–≤–µ–∑–¥—ã.', link: ccLegend, rating: 8 },
                        { type: 'TH' + th + ' –ü—É—à', description: '–õ–µ–≥–µ–Ω–¥-—Å—Ç–∏–ª—å: –∫–æ–º–ø–∞–∫—Ç–Ω–æ–µ —è–¥—Ä–æ, –ª–æ–≤—É—à–∫–∏ —É TH.', link: ccLegend, rating: 9 },
                        { type: 'TH' + th + ' –ü—É—à', description: '–¢—Ä—ë—Ö—Å–ª–æ–π–Ω–∞—è –∑–∞—â–∏—Ç–∞ —Ä–∞—Ç—É—à–∏. –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –∫—É–±–∫–æ–≤ –∏ –ª–∏–≥.', link: ccLegend, rating: 7 },
                        { type: 'TH' + th + ' –ü—É—à', description: '–°–∏–ª—å–Ω–æ–µ —è–¥—Ä–æ, –ª–æ–≤—É—à–∫–∏ –ø–æ —Å–µ–∫—Ç–æ—Ä–∞–º.', link: ccLegend, rating: 8 },
                        { type: 'TH' + th + ' –ü—É—à', description: '–ü—É—à-–±–∞–∑—ã. –í—Å–µ —Å ClashCodes ‚Üí Legend Bases.', link: ccLegend, rating: 8 }
                    ];
                }
                return [
                    { type: 'TH' + th + ' –í–æ–π–Ω–∞', description: '–í–æ–π–Ω–æ–≤—ã–µ –±–∞–∑—ã –Ω–∞ ClashCodes. –ê–Ω—Ç–∏-3 –∑–≤–µ–∑–¥—ã –¥–ª—è –ö–í–°.', link: ccWar, rating: 9, openLayoutId: th === 16 ? 'TH16:WB:AAAAAGAAAAAKOfe7qodr-ZAOJ31ivBv-z' : null },
                    { type: 'TH' + th + ' –í–æ–π–Ω–∞', description: '–í–æ–π–Ω–æ–≤–∞—è –±–∞–∑–∞ —Å —Å–∏–ª—å–Ω—ã–º –ø–µ—Ä–∏–º–µ—Ç—Ä–æ–º. –°–ª–æ–∂–Ω–æ –ª–∞–≤–∞–ª—É–Ω—è–º –∏ —ç–¥—Ä–∞–≥–∞–º.', link: ccWar, rating: 8 },
                    { type: 'TH' + th + ' –í–æ–π–Ω–∞', description: '–ê–Ω—Ç–∏-–≤—Å—ë: —Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∑–∞—â–∏—Ç–∞ –æ—Ç –≤–æ–∑–¥—É—Ö–∞ –∏ –∑–µ–º–ª–∏.', link: ccWar, rating: 9 },
                    { type: 'TH' + th + ' –í–æ–π–Ω–∞', description: '–ö–æ–º–ø–∞–∫—Ç–Ω–æ–µ —è–¥—Ä–æ, –ª–æ–≤—É—à–∫–∏ –Ω–∞ –ø–æ–¥—Ö–æ–¥–∞—Ö. –ê–Ω—Ç–∏-–∑–µ–º–ª—è.', link: ccWar, rating: 8 },
                    { type: 'TH' + th + ' –í–æ–π–Ω–∞', description: '–°–µ–∫—Ç–æ—Ä–Ω–∞—è –∑–∞—â–∏—Ç–∞, —Å–∏–ª—å–Ω—ã–µ —É–≥–ª—ã. War bases ‚Äî ClashCodes.', link: ccWar, rating: 7 },
                    { type: 'TH' + th + ' –í–æ–π–Ω–∞', description: '–í–æ–π–Ω–æ–≤–∞—è –±–∞–∑–∞ –¥–ª—è –ö–í–°. –í—Å–µ –±–∞–∑—ã —Å clashcodes.com/bases/war', link: ccWar, rating: 8 }
                ];
            }
            var PURPOSES = [{
                    id: 'farming',
                    emoji: 'ü™ô',
                    title: '–§–∞—Ä–º —Ä–µ—Å—É—Ä—Å–æ–≤',
                    desc: '–ó–∞—â–∏—Ç–∞ –∑–æ–ª–æ—Ç–∞ –∏ —ç–ª–∏–∫—Å–∏—Ä–∞. –ú–µ–Ω—å—à–µ –ø–æ—Ç–µ—Ä—å –ø—Ä–∏ —Ñ–∞—Ä–º–µ.'
                },
                {
                    id: 'push',
                    emoji: 'üèÜ',
                    title: '–ü—É—à –∫—É–±–∫–æ–≤',
                    desc: '–ó–∞—â–∏—Ç–∞ —Ä–∞—Ç—É—à–∏, –º–∏–Ω–∏–º—É–º –∑–≤—ë–∑–¥ –≤ –∑–∞—â–∏—Ç–µ.'
                },
                {
                    id: 'war',
                    emoji: '‚öîÔ∏è',
                    title: '–í–æ–π–Ω–∞ –∫–ª–∞–Ω–∞',
                    desc: '–ê–Ω—Ç–∏-3 –∑–≤–µ–∑–¥—ã –¥–ª—è –ö–í–° –∏ –≤–æ–π–Ω.'
                }
            ];
            var TH_LEVELS = [6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18];
            window.CocBaseData = {
                getThImageUrl: getThImageUrl,
                makeBases: makeBases,
                PURPOSES: PURPOSES,
                TH_LEVELS: TH_LEVELS
            };
        })();
    </script>
    <style>
        *,
        *::before,
        *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        :root {
            --bg: #0d0d0f;
            --bg-card: #141418;
            --bg-card-hover: #1a1a20;
            --surface: #18181c;
            --text: #f4f4f5;
            --text-muted: #b4b4bc;
            --accent: #d4a012;
            --accent-soft: rgba(212, 160, 18, 0.2);
            --success: #22c55e;
            --border: #27272a;
            --radius: 16px;
            --radius-sm: 12px;
            --font: 'Outfit', -apple-system, sans-serif;
            --header-h: 64px;
            --section-pad: clamp(28px, 6vw, 64px);
            --content-max: min(1600px, 96vw);
        }

        html {
            scroll-behavior: smooth;
            font-size: 18px;
        }

        @media (min-width: 1200px) {
            html {
                font-size: 19px;
            }
        }

        body {
            font-family: var(--font);
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            line-height: 1.55;
            -webkit-font-smoothing: antialiased;
        }

        /* Header */
        .header {
            position: sticky;
            top: 0;
            z-index: 100;
            height: var(--header-h);
            padding: 0 clamp(20px, 4vw, 40px);
            max-width: 100%;
            background: rgba(13, 13, 15, 0.92);
            backdrop-filter: blur(12px);
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .logo-link {
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--text);
            text-decoration: none;
            letter-spacing: -0.02em;
        }

        .logo-link span {
            color: var(--accent);
        }

        .nav {
            display: flex;
            gap: 12px;
        }

        .nav a {
            padding: 10px 18px;
            color: var(--text-muted);
            text-decoration: none;
            font-weight: 600;
            font-size: 1.05rem;
            border-radius: var(--radius-sm);
            transition: color 0.2s, background 0.2s;
        }

        .nav a:hover {
            color: var(--text);
            background: var(--surface);
        }

        /* Sections common */
        section {
            padding: var(--section-pad) clamp(20px, 4vw, 48px);
            max-width: var(--content-max);
            margin: 0 auto;
            width: 100%;
        }

        .section-title {
            font-size: clamp(1.6rem, 4vw, 2.2rem);
            font-weight: 800;
            margin-bottom: 12px;
            letter-spacing: -0.02em;
            line-height: 1.2;
            color: var(--text);
        }

        .section-desc {
            color: var(--text-muted);
            font-size: 1.1rem;
            line-height: 1.6;
            margin-bottom: 28px;
            max-width: 640px;
        }

        /* Hero */
        .hero {
            min-height: calc(100vh - var(--header-h) - 80px);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding-top: 40px;
            padding-bottom: 60px;
        }

        .hero h1 {
            font-size: clamp(2.4rem, 8vw, 4rem);
            font-weight: 800;
            letter-spacing: -0.03em;
            line-height: 1.15;
            margin-bottom: 20px;
            background: linear-gradient(180deg, #fff 0%, var(--accent) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .hero p {
            font-size: clamp(1.1rem, 2.5vw, 1.35rem);
            color: var(--text-muted);
            max-width: 560px;
            margin-bottom: 36px;
            line-height: 1.65;
        }

        .cta {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            padding: 16px 32px;
            background: var(--accent);
            color: #0d0d0f;
            font-family: var(--font);
            font-size: 1.1rem;
            font-weight: 700;
            border: none;
            border-radius: var(--radius);
            cursor: pointer;
            text-decoration: none;
            transition: transform 0.2s, box-shadow 0.2s, filter 0.2s;
        }

        .cta:hover {
            filter: brightness(1.1);
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(212, 160, 18, 0.35);
        }

        .cta:active {
            transform: translateY(0);
        }

        button.cta {
            cursor: pointer;
        }

        /* TH Grid ‚Äî –∫–∞—Ä—Ç–æ—á–∫–∏ —Å —Ñ–æ—Ç–æ —Ä–∞—Ç—É—à */
        #th-section .section-title {
            text-align: center;
        }

        #th-section .section-desc {
            text-align: center;
            margin-left: auto;
            margin-right: auto;
        }

        .th-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: clamp(12px, 2vw, 20px);
            justify-items: stretch;
        }

        @media (min-width: 480px) {
            .th-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (min-width: 700px) {
            .th-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        @media (min-width: 1000px) {
            .th-grid {
                grid-template-columns: repeat(6, 1fr);
            }
        }

        @media (min-width: 1400px) {
            .th-grid {
                grid-template-columns: repeat(11, 1fr);
                gap: 16px;
            }
        }

        .th-card {
            width: 100%;
            max-width: none;
            aspect-ratio: 1;
            background: var(--bg-card);
            border: 2px solid var(--border);
            border-radius: var(--radius);
            overflow: hidden;
            cursor: pointer;
            transition: border-color 0.2s, transform 0.2s, box-shadow 0.2s;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: stretch;
            text-decoration: none;
            color: inherit;
        }

        .th-card:hover,
        .th-card:focus {
            border-color: var(--accent);
            transform: translateY(-4px);
            box-shadow: 0 12px 28px rgba(0, 0, 0, 0.35);
        }

        .th-card.selected {
            border-color: var(--accent);
            box-shadow: 0 0 0 3px var(--accent-soft);
        }

        .th-card.selected .th-label-desc {
            color: var(--accent);
        }

        .th-card.selected .th-label-desc::after {
            content: ' ‚úì';
            font-weight: 700;
        }

        .th-card .th-img {
            width: 100%;
            flex: 1;
            min-height: 0;
            object-fit: contain;
            padding: clamp(16px, 3vw, 24px);
            display: block;
        }

        .th-card .th-label-wrap {
            width: 100%;
            background: var(--surface);
            padding: 14px 12px;
            flex-shrink: 0;
            text-align: center;
        }

        .th-card .th-label {
            font-family: system-ui, -apple-system, 'Segoe UI', Roboto, sans-serif;
            font-weight: 700;
            font-size: 1.2rem;
            font-variant-numeric: tabular-nums;
            letter-spacing: 0.08em;
            display: block;
            line-height: 1.2;
        }

        .th-card .th-label-desc {
            display: block;
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-top: 4px;
            font-weight: 500;
        }

        .th-card .th-label-fallback {
            font-size: 1.6rem;
            padding: 28px;
        }

        /* Purpose */
        .purpose-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 16px;
        }

        @media (min-width: 560px) {
            .purpose-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        .purpose-card {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            padding: 24px;
            background: var(--bg-card);
            border: 2px solid var(--border);
            border-radius: var(--radius);
            cursor: pointer;
            transition: border-color 0.2s, transform 0.2s, background 0.2s;
            text-align: left;
        }

        .purpose-card:hover,
        .purpose-card:focus {
            border-color: var(--accent);
            background: var(--bg-card-hover);
            transform: translateY(-2px);
        }

        .purpose-card .emoji {
            font-size: 2.75rem;
            margin-bottom: 14px;
        }

        .purpose-card .title {
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .purpose-card .desc {
            font-size: 1.05rem;
            color: var(--text-muted);
            line-height: 1.5;
        }

        /* Results */
        .results-loading {
            grid-column: 1 / -1;
            padding: 48px 24px;
            text-align: center;
            color: var(--text-muted);
            font-size: 1.1rem;
        }

        .results-grid {
            display: grid;
            gap: clamp(20px, 3vw, 28px);
        }

        @media (min-width: 500px) {
            .results-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (min-width: 800px) {
            .results-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (min-width: 1100px) {
            .results-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        @media (min-width: 1400px) {
            .results-grid {
                grid-template-columns: repeat(5, 1fr);
            }
        }

        .base-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            transition: box-shadow 0.2s, border-color 0.2s;
        }

        .base-card:hover {
            border-color: var(--border);
            box-shadow: 0 12px 32px rgba(0, 0, 0, 0.3);
        }

        .base-card .img-wrap {
            aspect-ratio: 1;
            background: #000;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .base-card .img-wrap img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .base-card .body {
            padding: 22px;
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .base-card .title {
            font-size: 1.15rem;
            font-weight: 700;
            margin-bottom: 10px;
            line-height: 1.35;
        }

        .base-card .desc {
            font-size: 1rem;
            color: var(--text-muted);
            margin-bottom: 14px;
            flex: 1;
            line-height: 1.5;
        }

        .base-card .rating {
            font-size: 1rem;
            color: var(--accent);
            margin-bottom: 18px;
        }

        .base-card .link-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            padding: 16px 22px;
            background: var(--success);
            color: #fff;
            font-family: var(--font);
            font-size: 1.05rem;
            font-weight: 600;
            border: none;
            border-radius: var(--radius-sm);
            cursor: pointer;
            text-decoration: none;
            transition: filter 0.2s, transform 0.15s;
        }

        .base-card .link-btn:hover {
            filter: brightness(1.08);
        }

        .base-card .link-btn:active {
            transform: scale(0.98);
        }

        .base-card .link-btn.copied {
            opacity: 0.9;
        }

        .base-card .link-open {
            display: block;
            margin-top: 12px;
            text-align: center;
            font-size: 1rem;
            color: var(--accent);
            text-decoration: none;
            font-weight: 600;
            transition: opacity 0.2s;
        }

        .base-card .link-open:hover {
            opacity: 0.9;
        }

        /* Help */
        .help-steps {
            display: grid;
            gap: 28px;
            max-width: 720px;
        }

        .help-step {
            display: flex;
            gap: 20px;
            align-items: flex-start;
        }

        .help-step .num {
            width: 40px;
            height: 40px;
            flex-shrink: 0;
            background: var(--accent-soft);
            color: var(--accent);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            font-size: 1.1rem;
        }

        .help-step h3 {
            font-size: 1.2rem;
            margin-bottom: 8px;
        }

        .help-step p {
            color: var(--text-muted);
            font-size: 1.05rem;
            line-height: 1.55;
        }

        .help-in-game {
            margin-top: 36px;
            padding: 28px;
            background: var(--surface);
            border-radius: var(--radius);
            border: 1px solid var(--border);
        }

        .help-in-game h3 {
            margin-bottom: 14px;
            font-size: 1.2rem;
        }

        .help-in-game ol {
            margin-left: 24px;
            color: var(--text-muted);
            font-size: 1.05rem;
            line-height: 1.6;
        }

        .help-in-game li {
            margin-bottom: 10px;
        }

        /* State: hide/show */
        .flow-step {
            display: none;
        }

        .flow-step.active {
            display: block;
        }

        .results-section .back-row {
            margin-bottom: 20px;
        }

        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: var(--accent);
            text-decoration: none;
            font-weight: 600;
            font-size: 0.95rem;
            transition: opacity 0.2s;
        }

        .back-link:hover {
            opacity: 0.9;
        }

        /* Telegram */
        body.tg-ready .header {
            background: var(--tg-theme-secondary-bg-color, rgba(13, 13, 15, 0.9));
        }
    </style>
</head>

<body>
    <header class="header">
        <a href="#hero" class="logo-link" data-scroll="hero">Coc<span>Base</span></a>
        <nav class="nav">
            <a href="#th-section" data-scroll="th-section">–ü–æ–¥–±–æ—Ä</a>
            <a href="#help" data-scroll="help">–ü–æ–º–æ—â—å</a>
        </nav>
    </header>

    <main>
        <section id="hero" class="hero">
            <h1>–ü–æ–¥–±–æ—Ä –±–∞–∑ Clash of Clans</h1>
            <p>–í—ã–±–µ—Ä–∏ —É—Ä–æ–≤–µ–Ω—å —Ä–∞—Ç—É—à–∏ –∏ —Ü–µ–ª—å ‚Äî –ø–æ–ª—É—á–∏ –±–∞–∑—ã —Å <a href="https://clashcodes.com/bases/war" target="_blank" rel="noopener" style="color:var(--accent);text-decoration:underline;">ClashCodes</a>. –§–∞—Ä–º, –ø—É—à –∫—É–±–∫–æ–≤ –∏–ª–∏ –≤–æ–π–Ω–∞ –∫–ª–∞–Ω–∞.</p>
            <button type="button" class="cta" id="cta-pick-base" data-scroll="th-section">–ü–æ–¥–æ–±—Ä–∞—Ç—å –±–∞–∑—É ‚Üí</button>
        </section>

        <section id="th-section">
            <h2 class="section-title">–í—ã–±–µ—Ä–∏ —É—Ä–æ–≤–µ–Ω—å —Ä–∞—Ç—É—à–∏</h2>
            <p class="section-desc">–û—Ç TH6 –¥–æ TH18 ‚Äî –∫–ª–∏–∫–Ω–∏ –ø–æ –∫–∞—Ä—Ç–æ—á–∫–µ. –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –≤—ã–±–µ—Ä–∏ —Ü–µ–ª—å: —Ñ–∞—Ä–º, –ø—É—à –∏–ª–∏ –≤–æ–π–Ω–∞.</p>
            <div class="th-grid" id="th-grid"></div>
        </section>

        <section id="purpose-section" class="flow-step">
            <div class="back-row">
                <a href="#" class="back-link" data-back="th">‚Üê –î—Ä—É–≥–æ–π TH</a>
            </div>
            <h2 class="section-title">–î–ª—è —á–µ–≥–æ –Ω—É–∂–Ω–∞ –±–∞–∑–∞?</h2>
            <p class="section-desc">–í—ã–±–µ—Ä–∏ –æ–¥–∏–Ω –≤–∞—Ä–∏–∞–Ω—Ç ‚Äî –ø–æ–∫–∞–∂–µ–º 6 –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö –±–∞–∑ —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –∏ —Å—Å—ã–ª–∫–∞–º–∏.</p>
            <div class="purpose-grid" id="purpose-grid"></div>
        </section>

        <section id="results-section" class="results-section flow-step">
            <div class="back-row">
                <a href="#" class="back-link" data-back="purpose">‚Üê –í—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥—É—é —Ü–µ–ª—å</a>
            </div>
            <h2 class="section-title">–¢–≤–æ–∏ –±–∞–∑—ã</h2>
            <p class="section-desc">–ù–∞–∂–º–∏ ¬´–û—Ç–∫—Ä—ã—Ç—å –≤ –∏–≥—Ä–µ¬ª ‚Äî —Å—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä—É–µ—Ç—Å—è –∏ –æ—Ç–∫—Ä–æ–µ—Ç—Å—è –∏–≥—Ä–∞ (–∏–ª–∏ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ CoC). –ï—Å–ª–∏ –±–∞–∑–∞ –Ω–µ –ø–æ–¥—Å—Ç–∞–≤–∏–ª–∞—Å—å ‚Äî –≤—Å—Ç–∞–≤—å —Å—Å—ã–ª–∫—É –≤ –ù–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –∏–≥—Ä—ã.</p>
            <div class="results-grid" id="results-grid"></div>
        </section>

        <section id="help">
            <h2 class="section-title">–ü–æ–º–æ—â—å</h2>
            <p class="section-desc">–ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è CocBase –∏ –∫–∞–∫ –≤—Å—Ç–∞–≤–∏—Ç—å –±–∞–∑—É –≤ –∏–≥—Ä—É.</p>
            <div class="help-steps">
                <div class="help-step">
                    <span class="num">1</span>
                    <div>
                        <h3>–í—ã–±–µ—Ä–∏ —É—Ä–æ–≤–µ–Ω—å —Ä–∞—Ç—É—à–∏</h3>
                        <p>–ù–∞ –≥–ª–∞–≤–Ω–æ–π –Ω–∞–∂–º–∏ ¬´–ü–æ–¥–æ–±—Ä–∞—Ç—å –±–∞–∑—É¬ª –∏ –∫–ª–∏–∫–Ω–∏ –ø–æ –∫–∞—Ä—Ç–æ—á–∫–µ —Å –Ω—É–∂–Ω–æ–π —Ä–∞—Ç—É—à–µ–π (TH6‚ÄìTH18).</p>
                    </div>
                </div>
                <div class="help-step">
                    <span class="num">2</span>
                    <div>
                        <h3>–í—ã–±–µ—Ä–∏ —Ü–µ–ª—å</h3>
                        <p>–§–∞—Ä–º ‚Äî –∑–∞—â–∏—Ç–∞ —Ä–µ—Å—É—Ä—Å–æ–≤. –ü—É—à ‚Äî –∑–∞—â–∏—Ç–∞ —Ä–∞—Ç—É—à–∏ –∏ –∫—É–±–∫–æ–≤. –í–æ–π–Ω–∞ ‚Äî –∞–Ω—Ç–∏-3 –∑–≤–µ–∑–¥—ã –¥–ª—è –ö–í–°.</p>
                    </div>
                </div>
                <div class="help-step">
                    <span class="num">3</span>
                    <div>
                        <h3>–û—Ç–∫—Ä–æ–π —Å—Å—ã–ª–∫—É –∏–ª–∏ —Å–∫–æ–ø–∏—Ä—É–π</h3>
                        <p>–ù–∞–∂–º–∏ ¬´–û—Ç–∫—Ä—ã—Ç—å –≤ –∏–≥—Ä–µ¬ª ‚Äî —Å—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä—É–µ—Ç—Å—è –∏ –æ—Ç–∫—Ä–æ–µ—Ç—Å—è –∏–≥—Ä–∞. –ò–ª–∏ ¬´–û—Ç–∫—Ä—ã—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É –±–∞–∑—ã¬ª ‚Äî –æ—Ç–∫—Ä–æ–µ—Ç—Å—è —Å–∞–π—Ç —Å –ª–µ–π–∞—É—Ç–æ–º.</p>
                    </div>
                </div>
            </div>
            <div class="help-in-game">
                <h3>–ö–∞–∫ –≤—Å—Ç–∞–≤–∏—Ç—å –±–∞–∑—É –≤ –∏–≥—Ä—É</h3>
                <ol>
                    <li>–û—Ç–∫—Ä–æ–π Clash of Clans.</li>
                    <li>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ (—à–µ—Å—Ç–µ—Ä—ë–Ω–∫–∞) ‚Üí ¬´–°–≤—è–∑–∞—Ç—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ¬ª –∏–ª–∏ ¬´–í—Å—Ç–∞–≤–∏—Ç—å —Å—Å—ã–ª–∫—É –±–∞–∑—ã¬ª.</li>
                    <li>–í—Å—Ç–∞–≤—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–Ω—É—é —Å—Å—ã–ª–∫—É ‚Äî –±–∞–∑–∞ –ø–æ–¥—Å—Ç–∞–≤–∏—Ç—Å—è –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä.</li>
                </ol>
            </div>
        </section>
    </main>

    <script>
        (function() {
            if (window.Telegram && window.Telegram.WebApp) {
                window.Telegram.WebApp.ready();
                window.Telegram.WebApp.expand();
                document.body.classList.add('tg-ready');
            }

            const D = window.CocBaseData;
            if (!D) {
                console.error('CocBaseData missing');
                return;
            }
            const {
                getThImageUrl,
                makeBases,
                PURPOSES,
                TH_LEVELS
            } = D;

            let state = {
                th: null,
                purpose: null
            };

            function scrollToSection(id) {
                const target = document.getElementById(id);
                if (!target) return;
                target.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
            }

            document.querySelectorAll('[data-scroll]').forEach(el => {
                el.addEventListener('click', function(e) {
                    e.preventDefault();
                    const id = this.getAttribute('data-scroll');
                    if (id) scrollToSection(id);
                });
            });

            var ctaBtn = document.getElementById('cta-pick-base');
            if (ctaBtn) {
                ctaBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    scrollToSection('th-section');
                });
            }

            const thGrid = document.getElementById('th-grid');
            TH_LEVELS.forEach(th => {
                const card = document.createElement('a');
                card.href = '#purpose-section';
                card.className = 'th-card';
                card.setAttribute('data-th', th);
                card.innerHTML = `
          <img class="th-img" src="${getThImageUrl(th)}" alt="–†–∞—Å—Å—Ç–∞–Ω–æ–≤–∫–∞ TH${th}" loading="lazy" onerror="this.style.display='none';this.nextElementSibling?.querySelector('.th-label')?.classList.add('th-label-fallback')">
          <div class="th-label-wrap">
            <span class="th-label">TH${th}</span>
            <span class="th-label-desc">–†–∞—Å—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–∞–∑—ã</span>
          </div>
        `;
                card.addEventListener('click', function(e) {
                    e.preventDefault();
                    state.th = th;
                    document.querySelectorAll('.th-card').forEach(c => c.classList.remove('selected'));
                    this.classList.add('selected');
                    document.getElementById('purpose-section').classList.add('active');
                    document.getElementById('results-section').classList.remove('active');
                    document.getElementById('purpose-section').scrollIntoView({
                        behavior: 'smooth'
                    });
                });
                thGrid.appendChild(card);
            });

            const purposeGrid = document.getElementById('purpose-grid');
            PURPOSES.forEach(p => {
                const card = document.createElement('button');
                card.type = 'button';
                card.className = 'purpose-card';
                card.setAttribute('data-purpose', p.id);
                card.innerHTML = `
          <span class="emoji">${p.emoji}</span>
          <span class="title">${p.title}</span>
          <span class="desc">${p.desc}</span>
        `;
                card.addEventListener('click', () => {
                    state.purpose = p.id;
                    const grid = document.getElementById('results-grid');
                    grid.innerHTML = '<div class="results-loading">–ó–∞–≥—Ä—É–∑–∫–∞ –±–∞–∑ —Å ClashCodes‚Ä¶</div>';
                    document.getElementById('results-section').classList.add('active');
                    document.getElementById('results-section').scrollIntoView({ behavior: 'smooth' });
                    var apiBase = (window.location.pathname || '').replace(/\/?index\.html$/, '') || '';
                    if (apiBase && !apiBase.startsWith('/')) apiBase = '/' + apiBase;
                    var apiUrl = (window.location.origin || '') + apiBase + '/api/bases?th=' + encodeURIComponent(state.th) + '&purpose=' + encodeURIComponent(state.purpose);
                    fetch(apiUrl).then(function(r) { return r.ok ? r.json() : Promise.reject(new Error('API error')); }).then(function(bases) {
                        if (Array.isArray(bases) && bases.length) renderResults(bases);
                        else renderResults(makeBases(state.th, state.purpose));
                    }).catch(function() {
                        renderResults(makeBases(state.th, state.purpose));
                    });
                });
                purposeGrid.appendChild(card);
            });

            var OPEN_LAYOUT_BASE = 'https://link.clashofclans.com/en?action=OpenLayout&id=';
            function renderResults(bases) {
                const grid = document.getElementById('results-grid');
                const thImg = getThImageUrl(state.th);
                var list = Array.isArray(bases) ? bases.slice(0, 6) : [];
                if (!list.length) list = makeBases(state.th, state.purpose);
                grid.innerHTML = list.map((b, i) => {
                    var actionUrl = b.openLayoutId ? (OPEN_LAYOUT_BASE + encodeURIComponent(b.openLayoutId)) : (b.link || '');
                    var imgSrc = (b.image_url && b.image_url.indexOf('http') === 0) ? b.image_url : thImg;
                    var ratingText = (b.rating_display != null) ? b.rating_display : (typeof b.rating === 'number' ? b.rating + '/10' : (b.rating || '‚Äî/10'));
                    return `
          <div class="base-card">
            <div class="img-wrap">
              <img src="${escapeAttr(imgSrc)}" alt="${escapeAttr(b.type || '')}" loading="lazy" onerror="this.src='${escapeAttr(thImg)}'">
            </div>
            <div class="body">
              <div class="title">${escapeHtml(b.type || '–ë–∞–∑–∞')} ‚Äî –±–∞–∑–∞ ${i + 1}</div>
              <div class="desc">${escapeHtml(b.description || '')}</div>
              <div class="rating">‚òÖ ${escapeHtml(String(ratingText))}</div>
              <button type="button" class="link-btn" data-link="${escapeAttr(actionUrl)}">üì± –û—Ç–∫—Ä—ã—Ç—å –≤ –∏–≥—Ä–µ</button>
              <a href="${escapeAttr(b.link || '#')}" target="_blank" rel="noopener" class="link-open">–û—Ç–∫—Ä—ã—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É –±–∞–∑—ã</a>
            </div>
          </div>
        `;
                }).join('');

                grid.querySelectorAll('.link-btn').forEach(btn => {
                    const link = btn.dataset.link;
                    if (!link) return;
                    btn.addEventListener('click', function() {
                        function doCopy() {
                            btn.textContent = '‚úì –û—Ç–∫—Ä—ã—Ç–æ! –í—Å—Ç–∞–≤—å –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ';
                            btn.classList.add('copied');
                            if (window.Telegram && window.Telegram.WebApp) {
                                window.Telegram.WebApp.showPopup({
                                    title: '–ì–æ—Ç–æ–≤–æ',
                                    message: '–ò–≥—Ä–∞ –¥–æ–ª–∂–Ω–∞ –æ—Ç–∫—Ä—ã—Ç—å—Å—è. –ï—Å–ª–∏ –±–∞–∑–∞ –Ω–µ –ø–æ–¥—Å—Ç–∞–≤–∏–ª–∞—Å—å ‚Äî –≤—Å—Ç–∞–≤—å —Å—Å—ã–ª–∫—É –≤ –ù–∞—Å—Ç—Ä–æ–π–∫–∞—Ö.'
                                });
                            }
                            tryOpenGame();
                        }

                        function tryOpenGame() {
                            var openUrl = (link.indexOf('link.clashofclans.com') !== -1) ?
                                link :
                                'https://link.clashofclans.com/en';
                            var a = document.createElement('a');
                            a.href = openUrl;
                            a.target = '_blank';
                            a.rel = 'noopener';
                            a.style.display = 'none';
                            document.body.appendChild(a);
                            setTimeout(function() {
                                try {
                                    a.click();
                                } catch (e) {}
                                document.body.removeChild(a);
                            }, 150);
                        }
                        if (navigator.clipboard && navigator.clipboard.writeText) {
                            navigator.clipboard.writeText(link).then(doCopy).catch(fallbackCopy);
                        } else {
                            fallbackCopy();
                        }

                        function fallbackCopy() {
                            var ta = document.createElement('textarea');
                            ta.value = link;
                            ta.style.position = 'fixed';
                            ta.style.opacity = '0';
                            document.body.appendChild(ta);
                            ta.select();
                            try {
                                document.execCommand('copy');
                            } catch (e) {}
                            document.body.removeChild(ta);
                            doCopy();
                        }
                    });
                });
            }

            document.querySelectorAll('.back-link[data-back="th"]').forEach(a => {
                a.addEventListener('click', function(e) {
                    e.preventDefault();
                    document.getElementById('purpose-section').classList.remove('active');
                    document.getElementById('results-section').classList.remove('active');
                    document.querySelectorAll('.th-card').forEach(c => c.classList.remove('selected'));
                    state.th = null;
                    state.purpose = null;
                    document.getElementById('th-section').scrollIntoView({
                        behavior: 'smooth'
                    });
                });
            });
            document.querySelectorAll('.back-link[data-back="purpose"]').forEach(a => {
                a.addEventListener('click', function(e) {
                    e.preventDefault();
                    document.getElementById('results-section').classList.remove('active');
                    document.getElementById('purpose-section').scrollIntoView({
                        behavior: 'smooth'
                    });
                });
            });

            function escapeAttr(s) {
                return String(s).replace(/&/g, '&amp;').replace(/"/g, '&quot;').replace(/'/g, '&#39;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
            }

            function escapeHtml(s) {
                return String(s).replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;');
            }
        })();
    </script>
</body>

</html>
